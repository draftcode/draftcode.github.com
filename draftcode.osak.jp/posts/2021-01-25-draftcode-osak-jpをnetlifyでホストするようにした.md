---
title: draftcode.osak.jpをNetlifyでホストするようにした
date: 2021-01-24T22:04
---
draftcode.osak.jpは適当にGoで書いた静的ファイルを生成する謎スクリプトで構成されていて、これがターミナルで文章を書く前提になっていた。5年ぐらい前にChromeOSに移行してから、ターミナルで日本語が入力できなくなったので、サイトの更新もほぼ止まっていた。

ちょっと前に「へーJamstackってやつがあるんだ。なんかアニソン歌ってる人たちでそんなのなかったっけ」って思ってスルーしていたけど、見てみるとCMSによっては適当にウェブサイト上で文章を書くと、それをGitHubにMarkdownとしてpushしてくれる仕組みになっているっぽかったので、それを利用してブラウザ上で更新できるようにしてみた。

利用しているのはNetlifyとNetlify CMSで、適当に設定したらなんかできるようになった。ちょっと前に静的ファイル生成部分だけなんか変えるか、と思ってBazelベースにしたので、それを拡張して自前でMarkdownをレンダリング、ファイルの再配置などを行うようにした。会社だとこういうBazelで何でもかんでもファイルを生成させるみたいなのをよくやってるんだけど、あんまり社外では見ない。やっぱりBazelは導入障壁が高いんだろうか。(BazelでGoをビルドするの面倒くさいけど)。Bazelでビルドパイプラインをすべて完結させると、Bazelをインストールすればすべて終了して便利。あと、複数言語でビルドパイプライン組みたい、みたいなときでもこれで完結する。しかしBazelを使ってビルドするとどうしても1分ちょいかかる。(追記: Bazelの共有キャッシュではなく、`--output_user_root`まるごとキャッシュすることで1分切るようになった)

https://github.com/draftcode/draftcode.github.com/tree/draftcode.osak.jp に色々全部入っている。サイトのデザインはr7kamura.comを丸パクリさせてもらった。読みやすいので。