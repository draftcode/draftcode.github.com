<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>RoboGuice2とRobolectricを組み合わせてテストを書く</title>
    <meta content='draftcode' name='author'>
    <meta content='3T_u3CXt1yC2LeNvWOzsMSPQrs_0Ek-XUnA8DYgu7zY' name='google-site-verification'>
    <link href='/stylesheets/old.css' rel='stylesheet'>
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700|Economica' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <div id='content'>
      <div id='article'>
  <div id='content_title'>
    <h1>RoboGuice2とRobolectricを組み合わせてテストを書く</h1>
  </div>
  <div id='posted_date'>
    Posted on 2012-10-17
  </div>
  <div id='content_body'>
    <p><a href="/2012/09/23/25036f39-d55f-45b2-97ca-19460353c847.html">RoboGuiceのInjectExtraを使うとテストがしにくくなる件について</a>でActivityのInjectionタイミングがずれることによりInjectExtraが利用できないことについて述べました。これをRoboGuice2にすることによって回避することができました。</p>
<h2>問題背景</h2>
<p>実機で動く場合は <code>RoboActivity.onCreate()</code> でInjectionが行われますが、 RoboGuice1だと、ActivityをテストにInjectする場合、次のようになってエラーが起きます:</p>

<ol>
<li>InjectするActivityのIntent付きのオブジェクトをアプリケーションの初めのほうでbindする。</li>
<li>bindするオブジェクトは、更にInjectionが走る。</li>
<li>InjectExtraはContextScopeで走らせないといけない。</li>
</ol>

<p>また、ActivityをテストにInjectしない場合は、RoboGuice1の場合、まともそうな方法でActivityをテストに渡す方法が無さそうです。staticにして渡してしまうのは、ちょっとアレですよね。</p>
<h2>RoboGuice2でなぜ解決されるのか</h2>
<p>RoboGuice1では、Applicationを継承して自分が必要なbindingを追加していました。しかしRoboGuice2ではApplicationを継承する必要がなくなり、適当なタイミングで bindingを追加できます。これを利用して、テストクラスの中でbindingを追加するようにすれば上記の問題が解決できます。</p>
<h2>サンプルコード</h2>
<script src="https://gist.github.com/3963845.js"> </script>

  </div>
</div>

    </div>
    <div id='disclaimer'>
      Disclaimer: The opinions stated here are my own, not necessarily those of my company.
    </div>
  </body>
</html>
