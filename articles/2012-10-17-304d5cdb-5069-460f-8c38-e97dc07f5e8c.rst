===================================================
RoboGuice2とRobolectricを組み合わせてテストを書く
===================================================
:Author: draftcode
:Date:   2012-10-17 10:03:49
:Slug:   304d5cdb-5069-460f-8c38-e97dc07f5e8c

`RoboGuiceのInjectExtraを使うとテストがしにくくなる件について`_ でActivityの
InjectionタイミングがずれることによりInjectExtraが利用できないことについて述べ
ました。これをRoboGuice2にすることによって回避することができました。

.. _`RoboGuiceのInjectExtraを使うとテストがしにくくなる件について`:
   http://draftcode.github.com/2012/09/23/25036f39-d55f-45b2-97ca-19460353c847.html

問題背景
========

実機で動く場合は ``RoboActivity.onCreate()`` でInjectionが行われますが、
RoboGuice1だと、ActivityをテストにInjectする場合、次のようになってエラーが起き
ます:

1. InjectするActivityのIntent付きのオブジェクトをアプリケーションの初めのほう
   でbindする。
2. bindするオブジェクトは、更にInjectionが走る。
3. InjectExtraはContextScopeで走らせないといけない。

また、ActivityをテストにInjectしない場合は、RoboGuice1の場合、まともそうな方法
でActivityをテストに渡す方法が無さそうです。staticにして渡してしまうのは、
ちょっとアレですよね。

RoboGuice2でなぜ解決されるのか
==============================

RoboGuice1では、Applicationを継承して自分が必要なbindingを追加していました。し
かしRoboGuice2ではApplicationを継承する必要がなくなり、適当なタイミングで
bindingを追加できます。これを利用して、テストクラスの中でbindingを追加するよう
にすれば上記の問題が解決できます。

サンプルコード
==============

.. raw:: html

    <script src="https://gist.github.com/3963845.js"> </script>

