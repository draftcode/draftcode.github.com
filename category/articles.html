<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>draftcode.github.com</title>
    <meta name="author" content="draftcode">
    <meta name="google-site-verification" content="YjRoDozMq67s3NKiyM6spjwqnSVihlZ11ur-OgfZCU0">

    <!--[if lt IE 9]>
    <script src="../theme/html5.js"></script>
    <![endif]-->

    <link href="../theme/bootstrap.min.css" rel="stylesheet">
    <link href="../theme/local.css" rel="stylesheet">
    <link href="../theme/pygments.css" rel="stylesheet">
    <link rel="alternate" type="application/atom+xml" title="Atom" href="../atom.xml">
    <link href='http://fonts.googleapis.com/css?family=Economica' rel='stylesheet'>
</head>

<body>

<h1 id="site-title"><a href="..">draftcode.github.com</a></h1>

<div id="content">


    <div class='article'>
        <div class="content-title">
            <a href="../2013/01/14/26d3c809-d75a-4277-9d5d-92e44b2f51a7.html"><h1>チーム開発レトロスペクティブ</h1></a>
            <div class="metadata">
    <span class="label label-inverse">2013/01/14</span>
    <a href="../category/Articles.html" class="label label-info">Articles</a>
</div>        </div>

        <div><p>大学の講義の関係で、4月から12月まで7人のチームで開発を行いました。自分の役割はチームリーダーでした。これはある種残念なことかもしれませんが、いろいろやりたいことができる立場であったので、やってみたいことを出来る範囲で盛り込んでいきました。この記事では、このチーム開発における制約条件を述べた後に、その制約下でできそうだと考えたことをまとめます。そして実際に行ったことについて、その意図と実際の運用結果、反省点をまとめます。最後に適当に雑感など述べます。</p>
<div class="section" id="id2">
<h2>制約条件</h2>
<p>このチーム開発を行うプロジェクトでは次のような制約条件がありました:</p>
<ul class="simple">
<li>開発期間は5月から11月まで</li>
<li>給与は出ない</li>
<li>チーム人数は6人から7人</li>
<li>開発するアプリケーションは「大学生の学びを楽しくするアプリケーション」</li>
<li>Android上で動作するアプリケーションであること</li>
</ul>
<p>これらの制約条件のうち最もきついのは最初の開発期間です。一見開発期間が半年以上あるように見えますが、実際は週3時間の講義があるだけです。それ以外の時間は自分たちで捻出しなければいけません。仮に講義以外の時間を5時間割いたとすると、週当たり8時間の作業時間になります。つまり週当たりフルタイムの仕事の5分の1の作業時間になるので、7ヶ月のうちの使えそうな開発期間は1ヶ月より少し多いぐらいです。ただ、8月と9月は夏休みになっていますし、他の講義、研究、ゼミをこなしながら週に5時間捻出できるとは考えにくいので、実際は1ヶ月より少し少ないぐらいになると考えられます。</p>
<p>次の制約条件の給与が出ない。これによってこのプロジェクトは企業内で行われるプロジェクトというよりかは、オープンソースプロジェクトに近いものになります。別にこの講義に参加しなくても卒業はできますし、もっと言えば作業しなくてもクビになるとか単位が出ないとかいう罰則はありません。</p>
<p>チーム人数については特にこれといって変なところはないと思います。ただ、このチームは好きな人と組んでやるわけではなく、完全にランダムです。(同じ研究室の人とは組めないという制約はあります)なので、お互い知らない人同士でチームを組むことになります。</p>
<p>開発するアプリケーションについては、テーマが与えられるだけで詳細は決まっていません。なので何を作るのか、どういう機能をもたせるのかについては全てチームで決めることになります。</p>
<p>開発プラットフォームについてはAndroidが指定されます。ただしチームメンバーのほとんどはAndroidで開発したことはないので、何ができるのかから学ぶ必要があります。</p>
</div>
<div class="section" id="id3">
<h2>制約条件下でできること</h2>
<p>まずなんといっても何もできません(笑)なんていったって、あったこともない人とチーム組んで何を作るのか決めて役割分担して全くいじったことのないプラットフォームの上で動くアプリケーションを企画・制作を1ヶ月で行わないといけないんです。しかもタダで。</p>
<p>しかし、チーム開発を始めた直前はこんなことにあまり気づいていなかったので、呑気に半年あればそれなりに終わるのではみたいなことを考えていました。どちらかというとこの時点で考えていたのは給与が出ないことです。言い換えるとチームのモチベーションのメンテナンスをどうやって行うかがこの時点で意識していた課題でした。これに対しては次のようなことをことが行えると考えました:</p>
<ul class="simple">
<li>チームっぽさを出す</li>
<li>チーム開発でしかできなさそうなことを行う</li>
<li>ベストプラクティス&quot;っぽい&quot;ことを行う</li>
</ul>
<p>最終的に、チーム開発でしかできなさそうなこととしては次のことを行えると考えました:</p>
<ul class="simple">
<li>ソースコードのピアレビュー</li>
</ul>
<p>また、ベストプラクティス&quot;っぽい&quot;こととしては、次のことを行えると考えました:</p>
<ul class="simple">
<li>テストをまじめに書く</li>
<li>リリースを細かくして段階的な開発を行う</li>
</ul>
<p>また、開発するアプリケーションには自由度がかなりあったので、次のようなことを掲げることを考えました:</p>
<ul class="simple">
<li>自分たちが「作りたいもの」ではなく自分たちが「使いたいもの」を作る</li>
</ul>
<p>逆にできなさそうだなぁと思って避けたものには次のようなものがあります:</p>
<ul class="simple">
<li>頻繁にミーティングを行う</li>
<li>進捗管理を細かく行う</li>
<li>リスク管理をする</li>
<li>超ヤバイアプリケーションを作る</li>
</ul>
<p>最初はこれらのようなことを考えてチーム開発に臨んでいきました。</p>
</div>
<div class="section" id="id4">
<h2>実際に行ったこと</h2>
<div class="section" id="id5">
<h3>チームっぽさを出す</h3>
<p>結果: 効果があったかは全くわからない。しかし、対外的に「変なチーム」であることをアピールできた。</p>
<p>「チームっぽさを出す」はチームメンバーのモチベーション維持のための施策として考えたものでした。なぜこれがモチベーションの維持につながるかはピープルウェアあたりに書いてあったと思います。(えぇっ！<a class="reference external" href="http://www.amazon.co.jp/exec/obidos/ASIN/4822281108/dcmbcd-22/">ピープルウェア</a>を読んでいないだって！？)</p>
<p>これは効果があったかはわかりませんが、実際自分のチーム名は変でしたし、アプリケーション名も変です。チームロゴもかなり早い段階でできてましたし、チームロゴステッカーを作った人もいました。自分はチーム名の最後に変な文字を突っ込んだぐらいしかやってなかったと思うので、チームメンバーが変なことをしようとして変なふうに動いてくれたのは良かったと思います。ラッキーですね。</p>
</div>
<div class="section" id="id7">
<h3>ソースコードのピアレビュー</h3>
<p>結果: 効果があったと言えると思う。しかし、いくつか問題もあった。</p>
<p>ピアレビューはチーム開発じゃないとできなさそうなこととして行いました。狙った効果としては、チーム開発じゃないとできないことを行なって、チーム開発をするメリットを演出しようということがまずひとつありますが、それ以外にも狙った効果があります:</p>
<ul class="simple">
<li>他人のコードを見て使ったことのないプラットフォームの知識を共有する</li>
<li>まずいコードが入るのを防ぐ</li>
<li>責任を分散する</li>
<li>他人から見られるという意識を持ってもらうことで書くコードの質を向上させる</li>
</ul>
<p>最初の目標であるチーム開発っぽさの演出は、チームメンバーの一人から「チーム開発をしている感じがする」という感想を聞いたことがあるので、効果があったと言えると思います。知識の共有はできているのかわかりませんでした。まずいコードが入るのを防ぐのはできたと思います。わかりにくい動作をするコードの混入を防いだというのは何回かあったと思います。責任の分散はどこまでできているかわかりませんが、他人の書いたコードの続きを書くことができていたので、ある程度達成できていると思います。コードの質の向上もどれぐらいできているのかわかりません。</p>
<p>ピアレビューについては他のチームのメンバー2人から、もしもう一度チーム開発をするなら導入するという意見を聞けました。どうやら責任の分散をメリットとして感じるようです。</p>
<p>問題もそれなりにありました。まずピアレビューをすることでリソースが削られていきます。ただ、これはレビューをするための時間が足りないというよりかは、レビューのやりとりの同期にかかる時間が大きかったです。逆にレビューを振ってしまえばレビュー自体にかかる時間は通常はそこまでかかりませんでした。</p>
<p>もう一つの問題は、レビューに際して議論が過熱して最終的に人格攻撃が行われてしまったことでした。これについては受けた側のメンバーと話して、お互い「まさか大学の授業でこんな心労を受けるとは」という感じの話をしたりしました。そのあとに、そこら辺のいざこざを一旦自分の方で引き受けて整理しようとした矢先にそのメンバーがメンタル的に復活したと言っていたので、自分としてはほぼ何もせずに終わりました。ただ逆にした側の方のケアをどうしようかというのも一緒に何もせずに終わってしまいました。</p>
</div>
<div class="section" id="id8">
<h3>テストをまじめに書く</h3>
<p>結果: 効果があったかはわからない。全部ではないが、それなりの部分でそれなりにテストがかけている。ただ、テストを書くのは技術が必要。</p>
<p>テスト、特にこの文脈だと自動化されたテストを書くことは、もう既にベストプラクティスではないかもしれないですが、あまり学生生活を行う上でテストを書くことはなかったので、書くようにするということを盛り込みました。何かしらテストを書くことで影響が出たかはわかりませんが、少なくとも単体テストや結合テストが出来る程度の設計になっています。</p>
<p>テストを書くのはやっぱり技術が必要で、最初は何をテストすればいいのかよくわからない感じになります。自分もそうだったのですが、最近流行りのテスト駆動開発の本で<a class="reference external" href="http://www.amazon.co.jp/exec/obidos/ASIN/0321503627/dcmbcd-22/">Growing Object-Oriented Software, Guided by Tests</a>を読んで、だいたいこんな感じというのがつかめました。最近は<a class="reference external" href="http://www.amazon.co.jp/exec/obidos/ASIN/4798124583/dcmbcd-22/">邦訳</a>も出たようです。</p>
<p>といっても、こういう本を読みあさって自分自身意図したテストをきちんと書けるようになったのは後のほうです。特に要求仕様を満たしているかを確認するための受け入れテストを書くために、要求仕様は測定可能な方法で記述しなければならないということに気づいて、要求仕様を書きなおしたのは最初のリリースの直前でした。この見直しは、<a class="reference external" href="http://www.amazon.co.jp/exec/obidos/ASIN/4822282910/dcmbcd-22/">成功する要求仕様 失敗する要求仕様</a>から学んだことから発生しています。</p>
</div>
<div class="section" id="id11">
<h3>リリースを細かくして段階的な開発を行う</h3>
<p>結果: 3段階のリリースができた。リリースの合間で要件の見直し、プライオリティの設定ができていたので効果があった。</p>
<p>一応マイルストーンを設定して、その度にとりあえず動くものがリリースできていました。最初のリリースの後にもう一度要件を見なおして次のリリースで達成する要件を確定し、それが終わったら最後のリリースに向けて何をするのかをもう一度決定する形になりました。リリースを細かくする意図の一つとしては、変化していく状況に合わせて舵取りができるようにするという事が挙げられると思いますが、これはきちんと達成できています。</p>
<p>ただ、「物事には優先順位があって、それに基いて優先度が高いものから実装していく」ということをもっと広めるべきだったと思いました。というのも、開発が終わった後のチームでのレビューのときに、「ブレインストーミングで出た意見を最終的に全部は達成することができなかった」という意見が聞こえたからです。すべてを達成できるわけではないから、いくつかの物事は最初からスコープアウトされたり、次のマイルストーンには入らない場合があるということは、当たり前ではないのかもしれません。この部分が共有できていないと、「いつまでたってもあの機能が実装されない」という感じに捉えられると思います。</p>
</div>
<div class="section" id="id12">
<h3>自分たちが「作りたいもの」ではなく自分たちが「使いたいもの」を作る</h3>
<p>結果: 常に意識していたかは分からないが、いくつかの機能を「リジェクト」できた。しかし、実際にDogfoodingはできなかった。</p>
<p>これは、大体が情報を専門にしているメンバーだったので、技術ベースのできるからやるという方向に行かないようにするためのセーフティとして掲げたものでした。これをチームメンバーがどれほど認識していたかはわかりませんが、少なくとも一人はそれをよく覚えているようです。実際、ある機能が作れそうだ、作るとしたらこういう課題があるがどうやって解決できそうか、という話題が上がったことはあったのですが、こういった機能は意図的に「自分たちが使いたいと思うものから外れるからやらない」というリジェクトをしています。</p>
<p>しかし、「作りたいもの」から離れることは出来ましたが、「使いたいもの」になっているかどうかは測定できていません。実際AndroidじゃなくてWebアプリだったなぁとは思うのですが。</p>
</div>
</div>
<div class="section" id="id13">
<h2>雑感</h2>
<p>普通にアルバイトをしてもサークルで活動しても現実は悪い方にも良い方にも変えることはできないし、その現実に対処して少しずつ変化させていけるから物事をなし得る人はすごいのだなぁと思うのですが、今回は思ったよりやりたいことができた感じがします。これはひょっとしたらちょっと残念なのかもしれません。というのも、他の人からもっとこうであるべきだというのがあっても良かったのかなぁと。しかし、リソースが足りない中でできることは限られているし、だいたい本に書いてあるようなことをピックアップして実践しているだけなので、こうも何もなかったかもしれません。</p>
<p>チームリーダーをしていて、実はこうなんじゃないかと思ったことを2つ挙げます。</p>
<div class="section" id="id14">
<h3>もっと「なぜ」を発信していくこと</h3>
<p>現実は変えにくいという原因の一つとして、人間は長期的な利益よりも短期的な利益を重視する傾向にあることが挙げられます。なので、長期的に利益がありそうだが、それ単体では実行する許可がおりなさそうなことを、短期的な利益をもたらすことと抱きあわせで実行して、長期的な利益がありそうなことを隠して行うという癖を身につけてしまいました。つまり、自分は長期的な利益に基づいた意図を隠すようになっています。これは変更に対して非常に保守的な環境や、コスト意識がシビアな環境では有効だったりするのですが、もっとゆるい環境ではそんなにひた隠しにする必要はなく、むしろちゃんと意図を述べないと誤解されたり、表面上の理解のみで終わってしまうことが多く、弊害が出るのではないかなと思ってきています。</p>
</div>
<div class="section" id="id15">
<h3>チームの雰囲気作りよりもチームの方針の採用基準を明確にすべき</h3>
<p>チームの雰囲気を重視して意見をあげやすいようにするというのが重要かなと思っていましたが、最近はこれをそこまで重要視しなくなりました。雰囲気は良いに越したことはないのですが、チームの雰囲気を重視する方針は逆に取れば、チームの方針は雰囲気やメンバー間の人間関係によって決定されるというメッセージを出しているのではと思えます。また、雰囲気を良くしようというのは成功することが前提の方針のようにも見えます。締め切り間際で忙しくなるにつれて、雰囲気は悪くなりえます。こういった状況に対して、単純に普段から雰囲気を良くしようという方針は何の意味もありません。</p>
<p>代わりに打ち出すべきなのは、チームの方針はそれを打ち出した人に依らず、単純に
「チームがそれを行うべきかどうか」という基準によって決まるというメッセージではないかなと思っています。こういうメッセージを出すことで、意見が出る条件が「雰囲気が良いかどうか」ではなく「意見として優れているかどうか」に変化することが期待出来ます。</p>
<p>次のような話があります:</p>
<blockquote>
<p>小学校の体育の時間のサッカーを見ていると、面白いことに気づきます。時間が来ると、試合終了の笛とともに先生がコートの真ん中に両チームを集めます。「三対二で赤組の勝ち！」と言うと、赤組の子どもたちは「やったー！」、白組の子どもたちは「残念……」。そこで白組の子どもたちに「どこがまずかったと思う？」と聞いてみると、「一点足りなかった」という答え。「じゃあ、次はどうしたらいいと思う？」と聞くと、「あと二点は取れるようにならなきゃ！」。つまり、子どもたちは成功失敗が「結果」でしかわからないのです。試合の中で、具体的にどこがまずかったのか、失敗の正体がつかめなければ、学習のしようがありません。</p>
<p class="attribution">&mdash;<a class="reference external" href="http://www.amazon.co.jp/exec/obidos/ASIN/4492532706/dcmbcd-22/">ストーリーとしての競争戦略</a>(楠木 建 p465)</p>
</blockquote>
<blockquote>
</blockquote>
<p>雰囲気がすぐれないと、意見は出にくくなります。特に雰囲気重視をしていた場合は顕著でしょう。雰囲気が優れていない状態になってしまったチーム全体が悪いことをしている気分になり得るからです。これに対する対処法として、普段から雰囲気を良くするというのは、上記の話の2点とらなくてはいけないという意見と変わらないように思えます。変えるとしたら雰囲気を悪くした原因そのものを潰すべきですが、どう頑張っても悪くなるときは悪くなります。であれば、悪くなっても弊害が出ないようにしておく方が良いのではないかと考えています。</p>
</div>
</div>
</div>
        <hr />
    </div>



    <div class='article'>
        <div class="content-title">
            <a href="../2012/10/17/304d5cdb-5069-460f-8c38-e97dc07f5e8c.html"><h1>RoboGuice2とRobolectricを組み合わせてテストを書く</h1></a>
            <div class="metadata">
    <span class="label label-inverse">2012/10/17</span>
    <a href="../category/Articles.html" class="label label-info">Articles</a>
</div>        </div>

        <div><p><a class="reference external" href="http://draftcode.github.com/2012/09/23/25036f39-d55f-45b2-97ca-19460353c847.html">RoboGuiceのInjectExtraを使うとテストがしにくくなる件について</a>でActivityの
InjectionタイミングがずれることによりInjectExtraが利用できないことについて述べました。これをRoboGuice2にすることによって回避することができました。</p>
<div class="section" id="id1">
<h2>問題背景</h2>
<p>実機で動く場合は<tt class="docutils literal">RoboActivity.onCreate()</tt>でInjectionが行われますが、
RoboGuice1だと、ActivityをテストにInjectする場合、次のようになってエラーが起きます:</p>
<ol class="arabic simple">
<li>InjectするActivityのIntent付きのオブジェクトをアプリケーションの初めのほうでbindする。</li>
<li>bindするオブジェクトは、更にInjectionが走る。</li>
<li>InjectExtraはContextScopeで走らせないといけない。</li>
</ol>
<p>また、ActivityをテストにInjectしない場合は、RoboGuice1の場合、まともそうな方法でActivityをテストに渡す方法が無さそうです。staticにして渡してしまうのは、ちょっとアレですよね。</p>
</div>
<div class="section" id="roboguice2">
<h2>RoboGuice2でなぜ解決されるのか</h2>
<p>RoboGuice1では、Applicationを継承して自分が必要なbindingを追加していました。しかしRoboGuice2ではApplicationを継承する必要がなくなり、適当なタイミングでbindingを追加できます。これを利用して、テストクラスの中でbindingを追加するようにすれば上記の問題が解決できます。</p>
</div>
<div class="section" id="id2">
<h2>サンプルコード</h2>
<script src="https://gist.github.com/3963845.js"> </script></div>
</div>
        <hr />
    </div>



    <div class='article'>
        <div class="content-title">
            <a href="../2012/08/01/5524f2e3-1431-4ee0-b04c-ab89ebdcdf4a.html"><h1>第(1+1)回 六本木 Linux カーネル読書会 参加メモ</h1></a>
            <div class="metadata">
    <span class="label label-inverse">2012/08/01</span>
    <a href="../category/Articles.html" class="label label-info">Articles</a>
</div>        </div>

        <div><p><a class="reference external" href="http://connpass.com/event/824/">第(1+1)回 六本木 Linux カーネル読書会</a>に行ってきたので、そのときのメモ。あまりメモがとれていない。今回はforkとかcloneあたり。</p>
<p>後で調べたこともいくつか追加している。</p>
<div class="topic">
<p class="topic-title first">do_fork (kernel/fork.c)</p>
<p>do_forkはsys_cloneやsys_vfork、sys_forkから呼ばれる。</p>
<dl class="docutils">
<dt>sys_clone</dt>
<dd>arch/x86/kernel/process.c</dd>
<dt>sys_vfork</dt>
<dd>arch/x86/kernel/process.c</dd>
<dt>sys_fork</dt>
<dd>arch/x86/kernel/process.c</dd>
<dt>task_struct</dt>
<dd>include/linux/sched.h</dd>
</dl>
</div>
<div class="topic">
<p class="topic-title first">vfork</p>
<p>古いBSDでfork &amp; execを効率的に行うための仕組み。現在では使われていない。</p>
<p>古いBSDだと、メモリ空間がCopy on Writeではなくて、fork時にコピーするようになっているらしい。このため、fork &amp; execをやろうとすると、無駄にメモリ空間のコピーが走ってしまう。これを防ぐために、vforkというものが生まれた。vforkは子プロセスが親プロセスのメモリ空間を使って動く。このままだと、親プロセスと子プロセスのスタックも共有してしまうので、まず、親プロセスを停止し、次に子プロセスを動かす。子プロセスがexecveを呼ぶかexitするまで、親プロセスは停止する。親プロセスのメモリ空間を利用するため、子プロセスの動きが大きく制約される。</p>
<p><a class="reference external" href="http://surf.ml.seikei.ac.jp/~nakano/JMwww/html/LDP_man-pages/man2/vfork.2.html">http://surf.ml.seikei.ac.jp/~nakano/JMwww/html/LDP_man-pages/man2/vfork.2.html</a></p>
<p>現代的なプログラムではvforkは使ってはいけない。</p>
<p><a class="reference external" href="http://www.jpcert.or.jp/sc-rules/c-pos33-c.html">http://www.jpcert.or.jp/sc-rules/c-pos33-c.html</a></p>
</div>
<div class="topic">
<p class="topic-title first">メモリ空間</p>
<p>カーネル空間とユーザー空間に分かれている。</p>
<dl class="docutils">
<dt>__user</dt>
<dd>include/linux/compiler.h</dd>
<dt>__kernel</dt>
<dd>include/linux/compiler.h</dd>
</dl>
<p>それぞれでメモリ管理をしているので仮想メモリ空間を指すことになる。</p>
</div>
<div class="topic">
<p class="topic-title first">copy_process (kernel/fork.c)</p>
<p>親プロセスのtask_structをコピーしている。</p>
<ul class="simple">
<li>dup_task_structを呼んでる。</li>
<li>sched_forkを呼んでる。</li>
</ul>
</div>
<div class="topic">
<p class="topic-title first">sched_fork (kernel/sched/core.c)</p>
<p>プロセスが実行される前のスケジューラ周りのセットアップを行うみたい。</p>
</div>
<div class="topic">
<p class="topic-title first">dup_task_struct (kernel/fork.c)</p>
<p>task_structのメモリ確保はkmem_cache_alloc_nodeで確保している。</p>
</div>
<div class="topic">
<p class="topic-title first">kmem_cache_alloc_node (include/kernel/slab.h)</p>
<p>カーネル空間のメモリを確保する関数。メモリの種類がいろいろ選べるらしい。</p>
<p><a class="reference external" href="http://www.mech.tohoku-gakuin.ac.jp/rde/contents/linux/drivers/tips1.html">http://www.mech.tohoku-gakuin.ac.jp/rde/contents/linux/drivers/tips1.html</a></p>
<p>kmem_cache_alloc_node の node は tsk_fork_get_node から取ってきている。しかしnodeは無視されてしまう。</p>
</div>
<div class="topic">
<p class="topic-title first">tsk_fork_get_node (kernel/kthread.c)</p>
<p>どうもNUMAアーキテクチャで気にするものらしい。</p>
<p>NUMA は Non-Uniform Memory Access の略で、たしかそれぞれのプロセッサでメモリを持っていて、他のプロセッサが持っているメモリにアクセスするときは、そのプロセッサにお願いして読みに行くというアーキテクチャだったと思う。</p>
</div>
<div class="topic">
<p class="topic-title first">RCUとは</p>
<p>リードコピーアップデート。Wikipedia参照。</p>
<p>どうも、Writerが入るときに、コピーを作ってそっちの方を指すようにする。で、
Readerは読み終わったら上手いことやって、さっきまで見ていた複製元が既に不要になっていたら破棄するようにするものらしい。</p>
<p><a class="reference external" href="http://togetter.com/li/153033">http://togetter.com/li/153033</a></p>
</div>
<div class="topic">
<p class="topic-title first">get_cpu, put_cpu (include/linux/smp.h)</p>
<dl class="docutils">
<dt>get_cpu</dt>
<dd>CPUの割り込みを禁止し、現在のCPUIDを返す。</dd>
<dt>put_cpu</dt>
<dd>CPUの割り込みを有効化。</dd>
</dl>
</div>
<div class="topic">
<p class="topic-title first">wake_up_new_task (kernel/sched/core.c)</p>
<p>do_forkの中で呼び出される。スケジューラに実際に登録する？</p>
</div>
<div class="topic">
<p class="topic-title first">do_execve (fs/exec.c)</p>
<p>これは次回で。</p>
</div>
<div class="topic">
<p class="topic-title first">Buddy memory allocation と Slab allocator</p>
<p>kmem_cache_alloc_node が定義されているのはslab.hなので、slabとは何か調べた。</p>
<p>Buddy memory allocationというメモリアロケーションメカニズムがあって、詳しくはわからないけれど、ページ*2^n単位でメモリを確保していくようなものらしい。これで切り取れるのはページ数単位なので、小さいオブジェクトを確保するのには向いていない。なので間にSlab allocatorというものが入って、小さいオブジェクトを切り出していきましょうという仕組みらしい。mallocと変わらない？いくつかの最適化もされるらしい。</p>
<ul class="simple">
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Buddy_memory_system">http://en.wikipedia.org/wiki/Buddy_memory_system</a></li>
<li><a class="reference external" href="http://wiki.bit-hive.com/linuxkernelmemo/pg/%A5%B9%A5%E9%A5%D6%A5%A2%A5%ED%A5%B1%A1%BC%A5%BF">http://wiki.bit-hive.com/linuxkernelmemo/pg/%A5%B9%A5%E9%A5%D6%A5%A2%A5%ED%A5%B1%A1%BC%A5%BF</a></li>
</ul>
<p>そもそもスラブというものが何かというと、同じサイズのオブジェクトを切り出すためのメモリのことらしい。</p>
<p><a class="reference external" href="http://wiki.bit-hive.com/north/pg/kmalloc(%A5%B9%A5%E9%A5%D6%A5%A2%A5%ED%A5%B1%A1%BC%A5%BF">http://wiki.bit-hive.com/north/pg/kmalloc(%A5%B9%A5%E9%A5%D6%A5%A2%A5%ED%A5%B1%A1%BC%A5%BF</a>)</p>
<p>スラブの割り当て状況みたいなのは/proc/slabinfoで参照できるらしく、さらに
topみたいなslabtopというコマンドもある。</p>
</div>
</div>
        <hr />
    </div>


     <div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="../category/articles.html">1</a></li>
    <li class=""><a href="../category/articles2.html">2</a></li>
    <li class=""><a href="../category/articles3.html">3</a></li>
    <li class=""><a href="../category/articles4.html">4</a></li>

    <li class="next"><a href="../category/articles2.html">Next &rarr;</a></li>

</ul>
</div> 
</div>

<div id="footer">
    <div id="about">
        <ul class="nav nav-list">
            <li class="nav-header">About the author</li>
        </ul>

        <div style="padding: 10px;">
            <a id="about-image" href="../pages/about.html" rel="alternate"><img src="../static/images/draftcode.png" style="width: 100.0px; height: 100.0px;"/></a>
            <p>東京で情報工学を専攻している大学院生です。</p>
        </div>
    </div>

    <div id="site">
        <ul class="nav nav-list">
            <li class="nav-header">Site</li>

            <li><a href="../archives.html">Archives</a>
            <li><a href="../atom.xml" rel="alternate">Atom feed</a></li>
        </ul>
    </div>

    <div id="category">
        <ul class="nav nav-list">
            <li class="nav-header">Categories</li>
                        <li><a href="../category/android.html">Android</a></li>            <li><a href="../category/articles.html">Articles</a></li>            <li><a href="../category/java.html">Java</a></li>            <li><a href="../category/python.html">Python</a></li>        </ul>
    </div>

    <div id="social">
        <ul class="nav nav-list">
            <li class="nav-header">Social</li>
                        <li class="social"><a href="http://twitter.com/#!/draftcode">Twitter</a></li>            <li class="social"><a href="http://github.com/draftcode">GitHub</a></li>            <li class="social"><a href="https://plus.google.com/107177890582465029754?rel=author">Google+</a></li>        </ul>
    </div>
</div>

</body>
</html>