<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>PelicanとGitHub Pagesを使う</title>
    <meta content='draftcode' name='author'>
    <meta content='3T_u3CXt1yC2LeNvWOzsMSPQrs_0Ek-XUnA8DYgu7zY' name='google-site-verification'>
    <link href='/stylesheets/old.css' rel='stylesheet'>
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700|Economica' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <div id='content'>
      <div id='article'>
  <div id='content_title'>
    <h1>PelicanとGitHub Pagesを使う</h1>
  </div>
  <div id='posted_date'>
    Posted on 2012-03-16
  </div>
  <div id='content_body'>
    <p>reStructuredTextが使いたかったので、Pythonで書かれてる<a href="http://pelican.notmyidea.org/en/2.8/index.html">Pelican</a> という静的ブログジェネレータを使ってHTMLを出力し、GitHub Pagesで公開するようにしました。</p>
<h2>Pelican</h2>
<p>最近は静的にブログを生成してくれるツールはたくさんあると思うんですが、どうも Markdownをなんか拡張したやつだったり、reStructuredTextを使っていても、ファイル内のメタデータをうまく使ってくれなかったり、自分が書いたエントリのディレクトリ内の位置を日付ごとのディレクトリにしなければいけなかったりして、あんまり好みのやつが見つからなかったんですが、最近みつけたPelicanはそのような制限がないので気に入って使っています。</p>

<p>自分はPelicanのソースを引っ張ってきて、開発中のバージョンを直接使っています。開発中のバージョンを使うにはこれだけでOK:</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="nv">$ </span>git clone https://github.com/ametaireau/pelican.git
<span class="nv">$ </span><span class="nb">cd </span>pelican
<span class="nv">$ </span>python setup.py develop
</code></pre></div>
<p>こうするとcloneしてきたディレクトリにあるファイルを使うようにうまくリンクが張られて、ちょっとコードの修正して動かしてみるっていうのが簡単にできるようになります。</p>
<h2>GitHub Pages</h2>
<p>なんかGitHubには <a href="http://pages.github.com/">GitHub Pages</a> っていうPushすると中のHTMLが公開されるというおしゃれ機能があって、それを使って公開するようにしました。で、自分が使っているのはUser Pagesなんですが、どのブランチにPushしたら公開されるのかが書いてなくて、どうもやってみた感じmasterに公開されたやつしか公開されないみたいです。UserPagesの場合はgh-pagesにPushしても無駄みたいですよ。わからないけど。なので次のようなブランチ構成にしてみました:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">source   -&gt; origin/source
gh-pages -&gt; origin/master
</code></pre></div>
<p>こういう風にするには、たぶん次のようにすればいいはず:</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="nv">$ </span>git init .
<span class="nv">$ </span>git branch -m master <span class="nb">source</span>
<span class="nv">$ </span>git remote add origin &lt;自分のGitHubリポジトリでコピーしてきたなにか&gt;
</code></pre></div>
<p>gh-pagesはなんかよしなに作ってくれる<a href="https://github.com/davisp/ghp-import">ghp-import</a> があるので、それを導入しました:</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="nv">$ </span>pip install ghp-import
</code></pre></div><h2>conf.pyを書く</h2>
<p><a href="https://github.com/draftcode/draftcode.github.com/tree/source/conf.py">conf.py</a>みたいに書いています。なんか下の方で怪しいことしてますが。ディレクトリ構成は<a href="https://github.com/draftcode/draftcode.github.com/tree/source">draftcode/draftcode.github.com</a>みたいになってます。</p>
<h2>post-commitを仕込む</h2>
<p>次のような内容のファイルを、 <code>.git/hooks/post-commit</code> に仕込んでおきます:</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="nv">$ </span>pelican -s conf.py <span class="o">&amp;&amp;</span> ghp-import output <span class="o">&amp;&amp;</span> git push origin gh-pages:master <span class="nb">source</span>:source
</code></pre></div>
<p>これでなんかコミットしたらページがビルドされてPushされます。しばらく待つと向こうの方のページにも反映されます。やったね!</p>

  </div>
</div>

    </div>
    <div id='disclaimer'>
      Disclaimer: The opinions stated here are my own, not necessarily those of my company.
    </div>
  </body>
</html>
